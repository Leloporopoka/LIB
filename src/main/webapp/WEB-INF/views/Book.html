<!DOCTYPE html >
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Book</title>
    <link href="..\resources\CSS\bootstrap.min.css" rel="stylesheet">
    <link href="..\resources\CSS\style.css" rel="stylesheet">
    <link href="..\resources\CSS\footer.css" rel="stylesheet"  type="text/css">
    <script type="text/javascript" src="..\resources\JS\jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="..\resources\JS\bootstrap.min.js"></script>

</head>
<body>
<div th:replace="fragments/nav :: nav"></div>


<div class="container">
    <div class="book">
        <div class="media">

        <img height="330px" width="230px"  th:src="@{${'data:image/jpeg;base64,'+book.base64}}" alt=""  class="align-self-start mr-3">
            <div class="media-body">
            <h2 th:text="${book.name}"></h2>
                <h6 th:text="'By '+${book.author}"></h6>
                <p th:text="${book.edition} +' edition'"></p>
                <p th:text="${book.description}"></p>
                <a th:unless="${book.eversion==0}" th:href="@{${'/oread/'+book.id}}">Read Online</a>
            </div>
        </div>


        <form th:action="@{/bookRate}" method="POST" th:unless="${user==null}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden"  name="user_id" th:value="${user.id}"/>
            <input type="hidden" name="book_id" th:value="${book.id}"/>

            <button class="btn btn-primary" type="submit" name="rating" th:value="1">
                1
            </button>
            <button class="btn btn-primary" type="submit" name="rating" th:value="2">
                2
            </button>
            <button class="btn btn-primary" type="submit" name="rating" th:value="3">
                3
            </button>
            <button class="btn btn-primary" type="submit" name="rating" th:value="4">
                4
            </button>
            <button class="btn btn-primary" type="submit" name="rating" th:value="5">
                5
            </button>

        </form>
        <h4 th:text="'Rating '+ ${rating}"></h4>




         <div class="tags">

             <h5>Tags:</h5>
                 <div class="tag" th:each="tag : ${book.tags}"><a th:href="@{/searchByTag(child=${tag.name})}" th:text="${tag.name}"></a></div>
             <br>


                     <div th:if="${book.amount==0}">
             <button  type="button" class="btn-dark disabled"  id="reserv" disabled>Reserve</button>
                     <div class="alert alert-danger" role="alert">
                         This book is not available for reservation as it is not in the library at the moment.
                        </div>
                     </div>

                     <button th:unless="${book.amount==0}" type="button" class="btn-dark reserv"  id="reserv"  data-toggle="modal" data-target="#ReserveBook" >Reserve</button>


         </div>


         </div>
    </div>

<div class="modal fade" id="ReserveBook" tabindex="-1" role="dialog" aria-labelledby="ReserveBookCenter" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title" id="ReserveBookLongTitle" >Reserve Book</h1>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="/reserve" method="post" >

                <div class="modal-body">
                            <div class="form-group" th:if="${user==null}">
                                <label for="recipient-name" class="col-form-label">Student Id:</label>
                                <input type="text" class="form-control"    id="recipient-name" th:name="student_id"/>
                            </div>

                            <div class="form-group" th:unless="${user==null}">
                                <label for="recipient-nam" class="col-form-label">Student Id:</label>
                                <input type="text" class="form-control"    id="recipient-nam" th:name="student_id" th:value="${user.login}"/>
                            </div>

                            <div class="form-group">
                                <label for="text" class="col-form-label">Password:</label>
                                <input type="password" class="form-control"  id="text" th:name="student_password"/>
                            </div>
                            <input hidden  class="form-control"  id="password-text" name="book" th:value="${book.id}"/>
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Reserve</button>
                </div>
            </form>




        </div>
    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>
</body>
</html>
